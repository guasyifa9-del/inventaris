<?php
 goto hsKUZ; ylhGd: $path = str_replace($base_path, '', $path); goto xHqpU; fVY_F: class ApiController { private $connection; private $headers; public function __construct($connection) { $this->connection = $connection; $this->setHeaders(); } private function setHeaders() { header("\x43\x6f\x6e\164\145\156\164\x2d\124\x79\x70\145\x3a\x20\x61\x70\x70\154\x69\x63\x61\x74\x69\x6f\156\x2f\152\163\157\x6e\x3b\x20\143\x68\141\162\x73\145\164\75\x55\x54\x46\x2d\70"); header("\101\x63\x63\x65\163\163\x2d\103\x6f\x6e\x74\162\157\154\55\x41\x6c\x6c\157\167\x2d\117\162\x69\x67\x69\x6e\72\40\52"); header("\x41\143\x63\145\x73\163\55\x43\157\x6e\164\x72\157\154\x2d\x41\x6c\x6c\157\x77\55\x4d\x65\164\150\157\x64\163\x3a\40\x47\x45\x54\54\x20\120\x4f\123\124\x2c\x20\x50\x55\124\x2c\x20\x44\x45\x4c\x45\x54\105\x2c\40\117\x50\x54\111\x4f\x4e\123"); header("\101\x63\x63\145\x73\163\x2d\103\x6f\156\164\162\x6f\x6c\55\101\x6c\x6c\x6f\167\55\110\x65\141\144\145\162\x73\x3a\40\x43\x6f\x6e\164\x65\156\164\55\124\x79\160\145\x2c\40\x41\165\164\150\x6f\x72\x69\172\141\164\x69\x6f\x6e\x2c\x20\130\55\122\145\161\165\145\163\164\145\144\x2d\127\151\x74\150"); if ($_SERVER["\x52\x45\121\x55\x45\123\x54\x5f\x4d\x45\124\110\x4f\x44"] === "\117\120\x54\x49\x4f\x4e\123") { http_response_code(200); die; } } private function respond($data, $status = 200) { http_response_code($status); echo json_encode($data, JSON_UNESCAPED_UNICODE | JSON_PRETTY_PRINT); die; } private function getAuthToken() { $headers = getallheaders(); if (isset($headers["\x41\165\x74\150\x6f\x72\151\x7a\141\164\151\157\x6e"])) { $auth = $headers["\101\165\x74\150\157\x72\151\172\141\x74\151\157\x6e"]; if (preg_match("\57\x42\145\141\162\x65\162\x5c\163\x28\x5c\x53\x2b\51\x2f", $auth, $matches)) { return $matches[1]; } } return null; } private function verifyToken($token) { if (!$token) { return null; } $decoded = base64_decode($token); $parts = explode("\x3a", $decoded); if (count($parts) !== 4) { return null; } list($user_id, $role, $timestamp, $signature) = $parts; $secret = getenv("\x4a\127\124\x5f\123\105\x43\x52\x45\x54") ?: "\x79\x6f\x75\x72\x2d\163\x65\x63\x72\145\x74\x2d\153\145\171"; $expected_sig = hash_hmac("\x73\150\x61\62\65\66", "{$user_id}\72{$role}\x3a{$timestamp}", $secret); if (!hash_equals($expected_sig, $signature)) { return null; } if (time() - $timestamp > 86400) { return null; } $stmt = mysqli_prepare($this->connection, "\123\105\x4c\105\x43\124\40\x2a\40\x46\122\117\115\40\x75\163\145\162\x73\40\x57\x48\x45\122\x45\x20\165\163\145\162\137\x69\x64\40\x3d\x20\77\40\101\x4e\x44\40\163\x74\x61\164\165\x73\x20\75\40\47\141\143\164\x69\x76\x65\47"); mysqli_stmt_bind_param($stmt, "\x69", $user_id); mysqli_stmt_execute($stmt); $result = mysqli_stmt_get_result($stmt); $user = mysqli_fetch_assoc($result); return $user; } private function generateToken($user_id, $role) { $timestamp = time(); $secret = getenv("\x4a\x57\x54\x5f\x53\x45\103\x52\x45\124") ?: "\x79\157\x75\x72\x2d\x73\145\x63\x72\145\164\55\153\145\171"; $signature = hash_hmac("\x73\150\x61\62\65\x36", "{$user_id}\x3a{$role}\x3a{$timestamp}", $secret); $token_data = "{$user_id}\x3a{$role}\x3a{$timestamp}\x3a{$signature}"; return base64_encode($token_data); } private function requireAuth() { $token = $this->getAuthToken(); $user = $this->verifyToken($token); if (!$user) { $this->respond(array("\163\x75\x63\x63\x65\163\x73" => false, "\x6d\145\163\x73\x61\147\x65" => "\125\x6e\141\165\x74\150\x6f\x72\x69\172\x65\144\x2e\x20\111\156\166\x61\x6c\151\144\x20\157\162\x20\x65\170\x70\x69\x72\x65\x64\40\164\157\x6b\x65\156\56"), 401); } return $user; } public function login() { $input = json_decode(file_get_contents("\160\150\160\72\57\x2f\x69\x6e\160\165\x74"), true); if (!isset($input["\x75\163\145\162\x6e\x61\155\145"]) || !isset($input["\x70\141\x73\163\x77\157\162\144"])) { $this->respond(array("\163\165\x63\143\145\x73\x73" => false, "\155\x65\x73\163\141\x67\145" => "\x55\x73\x65\162\156\x61\155\x65\40\141\156\x64\x20\160\x61\x73\x73\167\x6f\x72\x64\x20\162\145\161\x75\151\162\145\144"), 400); } $username = $input["\165\x73\x65\x72\156\x61\155\x65"]; $password = $input["\x70\141\x73\x73\x77\x6f\162\x64"]; $stmt = mysqli_prepare($this->connection, "\123\105\x4c\105\x43\x54\x20\x2a\40\106\x52\117\x4d\40\165\163\145\162\x73\x20\127\110\105\122\x45\40\x75\x73\145\162\x6e\141\x6d\x65\40\75\40\x3f\40\x41\116\104\x20\163\x74\x61\164\x75\163\x20\x3d\40\x27\141\143\164\x69\x76\x65\x27"); mysqli_stmt_bind_param($stmt, "\163", $username); mysqli_stmt_execute($stmt); $result = mysqli_stmt_get_result($stmt); $user = mysqli_fetch_assoc($result); if (!$user || !password_verify($password, $user["\160\141\163\x73\x77\157\162\x64"])) { $this->respond(array("\163\x75\x63\143\145\163\x73" => false, "\x6d\x65\163\x73\x61\x67\145" => "\x49\x6e\166\141\x6c\x69\144\40\x63\x72\145\144\x65\x6e\x74\151\141\154\x73"), 401); } $token = $this->generateToken($user["\x75\x73\145\x72\x5f\x69\x64"], $user["\x72\x6f\x6c\x65"]); $stmt = mysqli_prepare($this->connection, "\x55\120\x44\x41\x54\105\40\165\x73\x65\x72\x73\40\x53\105\124\x20\x6c\x61\163\164\x5f\154\157\x67\x69\x6e\x20\75\40\116\x4f\127\50\x29\40\127\110\105\x52\105\40\x75\163\x65\162\x5f\x69\144\x20\x3d\40\77"); mysqli_stmt_bind_param($stmt, "\151", $user["\165\163\x65\162\x5f\151\x64"]); mysqli_stmt_execute($stmt); $this->respond(array("\163\165\143\143\145\x73\163" => true, "\x6d\x65\x73\163\141\147\145" => "\x4c\157\x67\x69\156\x20\163\x75\143\143\x65\163\163\146\165\154", "\x64\x61\x74\141" => array("\164\x6f\x6b\x65\x6e" => $token, "\165\x73\145\x72" => array("\165\163\145\x72\137\151\x64" => $user["\165\163\x65\x72\137\151\144"], "\x75\x73\145\162\156\x61\155\x65" => $user["\x75\x73\145\x72\x6e\141\155\145"], "\x6e\x61\x6d\x61\137\154\145\156\x67\x6b\x61\160" => $user["\x6e\x61\x6d\x61\137\x6c\x65\x6e\x67\x6b\x61\x70"], "\145\x6d\x61\151\154" => $user["\145\155\141\151\154"], "\162\x6f\154\x65" => $user["\x72\x6f\x6c\x65"], "\144\x65\x70\141\162\x74\x65\155\145\x6e" => $user["\144\x65\x70\141\162\x74\x65\x6d\145\x6e"]))), 200); } public function getBarang() { $this->requireAuth(); $search = $_GET["\x73\145\141\162\x63\150"] ?? ''; $kategori = $_GET["\153\141\x74\x65\147\x6f\x72\x69"] ?? ''; $status = $_GET["\x73\164\x61\164\x75\x73"] ?? "\x61\x63\x74\151\166\145"; $page = (int) ($_GET["\160\x61\x67\x65"] ?? 1); $limit = (int) ($_GET["\154\x69\155\151\x74"] ?? 20); $offset = ($page - 1) * $limit; $query = "\123\x45\x4c\x45\x43\x54\40\142\56\x2a\x2c\x20\x6b\56\156\x61\x6d\141\x5f\x6b\x61\x74\145\147\x6f\x72\151\x2c\x20\153\x2e\151\x63\x6f\x6e\xa\x20\x20\40\x20\x20\40\40\40\x20\x20\40\x20\40\x20\40\x20\x20\x20\106\x52\x4f\x4d\x20\142\x61\162\141\156\147\x20\142\12\40\x20\x20\40\40\x20\40\x20\40\x20\40\x20\x20\x20\40\x20\40\40\114\105\106\124\x20\x4a\x4f\x49\x4e\40\x6b\x61\164\x65\147\157\x72\151\x20\x6b\x20\117\x4e\x20\142\56\153\141\164\145\147\157\x72\151\137\151\x64\x20\x3d\40\153\x2e\153\x61\164\x65\147\157\x72\x69\137\151\144\12\x20\40\x20\40\x20\x20\40\40\40\x20\40\40\40\x20\x20\40\x20\x20\x57\x48\105\x52\x45\40\x62\x2e\x73\x74\x61\164\165\163\x20\x3d\40\77"; $params = array($status); $types = "\x73"; if ($search) { $query .= "\40\x41\116\104\x20\50\x62\56\156\x61\x6d\141\137\142\x61\162\x61\x6e\147\x20\114\x49\x4b\105\x20\x3f\40\117\122\x20\142\x2e\153\157\144\145\x5f\142\x61\x72\x61\156\147\40\x4c\x49\113\x45\40\x3f\x29"; $search_param = "\45{$search}\x25"; $params[] = $search_param; $params[] = $search_param; $types .= "\x73\163"; } if ($kategori) { $query .= "\x20\x41\116\104\x20\x62\56\153\x61\x74\145\147\157\x72\151\x5f\151\x64\x20\75\40\77"; $params[] = (int) $kategori; $types .= "\x69"; } $count_stmt = mysqli_prepare($this->connection, str_replace("\123\105\114\x45\x43\x54\40\x62\56\x2a\54\40\153\x2e\156\141\x6d\x61\x5f\x6b\x61\164\x65\x67\157\162\x69\x2c\40\153\x2e\151\x63\157\156", "\123\x45\x4c\105\x43\124\x20\x43\117\125\116\124\x28\x2a\x29", $query)); mysqli_stmt_bind_param($count_stmt, $types, ...$params); mysqli_stmt_execute($count_stmt); $count_result = mysqli_stmt_get_result($count_stmt); $total = mysqli_fetch_row($count_result)[0]; $query .= "\x20\117\122\x44\105\x52\40\x42\131\40\142\56\x63\162\145\141\164\x65\144\x5f\x61\164\x20\104\105\123\x43\40\114\x49\115\x49\x54\x20\77\40\x4f\106\x46\123\105\124\40\x3f"; $params[] = $limit; $params[] = $offset; $types .= "\x69\151"; $stmt = mysqli_prepare($this->connection, $query); mysqli_stmt_bind_param($stmt, $types, ...$params); mysqli_stmt_execute($stmt); $result = mysqli_stmt_get_result($stmt); $barang = array(); while ($row = mysqli_fetch_assoc($result)) { if ($row["\147\x61\155\x62\x61\162"]) { $row["\x67\141\x6d\142\x61\162\x5f\165\162\154"] = getenv("\101\120\x50\137\125\x52\114") . "\57\165\160\154\157\141\x64\x73\x2f\142\141\162\x61\156\147\57" . $row["\x67\x61\x6d\142\x61\x72"]; } $barang[] = $row; } $this->respond(array("\x73\x75\x63\x63\145\x73\163" => true, "\x64\x61\x74\141" => $barang, "\x70\x61\x67\151\x6e\141\x74\151\x6f\x6e" => array("\160\x61\x67\145" => $page, "\x6c\151\x6d\151\164" => $limit, "\x74\x6f\164\141\154" => (int) $total, "\x74\157\x74\x61\154\x5f\x70\141\147\x65\x73" => ceil($total / $limit))), 200); } public function getBarangById($barang_id) { $this->requireAuth(); $stmt = mysqli_prepare($this->connection, "\x53\105\x4c\105\x43\124\x20\142\x2e\52\x2c\x20\x6b\x2e\156\x61\155\x61\x5f\x6b\x61\x74\x65\147\x6f\x72\151\x2c\40\x6b\56\x69\143\x6f\156\54\40\153\56\x69\x73\x5f\142\145\162\x62\x61\171\141\x72\x5f\x64\x65\x66\141\x75\x6c\164\xa\40\x20\40\x20\x20\40\40\x20\40\x20\40\40\x20\x46\x52\x4f\x4d\40\142\141\162\x61\156\147\40\142\xa\40\40\40\40\40\40\40\x20\40\40\x20\40\x20\x4c\105\x46\x54\40\112\x4f\111\x4e\x20\153\141\x74\x65\x67\157\x72\x69\x20\153\x20\x4f\x4e\x20\142\x2e\153\141\164\x65\147\x6f\162\x69\137\151\x64\40\75\x20\153\x2e\x6b\x61\164\x65\147\x6f\162\x69\x5f\151\144\12\40\x20\x20\40\40\40\40\40\x20\40\x20\x20\x20\x57\x48\x45\x52\105\40\x62\56\x62\x61\162\141\x6e\x67\x5f\151\x64\x20\x3d\40\77"); mysqli_stmt_bind_param($stmt, "\x69", $barang_id); mysqli_stmt_execute($stmt); $result = mysqli_stmt_get_result($stmt); $barang = mysqli_fetch_assoc($result); if (!$barang) { $this->respond(array("\x73\x75\143\143\x65\x73\163" => false, "\155\x65\163\163\x61\147\x65" => "\x42\x61\162\x61\156\147\40\x6e\x6f\164\40\x66\157\x75\x6e\x64"), 404); } if ($barang["\x67\141\x6d\142\x61\162"]) { $barang["\x67\x61\155\x62\x61\x72\x5f\x75\x72\154"] = getenv("\101\120\120\x5f\x55\x52\x4c") . "\57\x75\160\154\157\141\x64\x73\57\142\x61\162\x61\x6e\x67\x2f" . $barang["\x67\x61\x6d\x62\141\162"]; } $this->respond(array("\x73\x75\x63\143\x65\163\x73" => true, "\x64\141\164\x61" => $barang), 200); } public function getPeminjaman() { $user = $this->requireAuth(); $status = $_GET["\x73\x74\x61\164\165\x73"] ?? ''; $page = (int) ($_GET["\160\x61\x67\x65"] ?? 1); $limit = (int) ($_GET["\154\151\x6d\151\164"] ?? 20); $offset = ($page - 1) * $limit; $query = "\123\105\x4c\105\x43\x54\x20\160\x2e\52\x2c\x20\x75\x2e\x6e\x61\155\x61\x5f\154\x65\156\x67\x6b\x61\160\54\40\165\x2e\144\x65\x70\x61\162\164\145\x6d\145\156\xa\x20\x20\40\x20\40\40\40\x20\40\40\x20\40\x20\40\x20\x20\40\40\106\122\x4f\115\40\160\x65\x6d\x69\x6e\x6a\141\155\141\x6e\40\x70\xa\40\40\40\x20\x20\40\40\40\x20\40\40\x20\40\40\x20\x20\x20\40\112\117\x49\116\x20\165\x73\145\x72\163\x20\x75\40\117\x4e\x20\x70\56\x75\x73\145\162\137\x69\144\40\75\40\165\56\x75\163\x65\162\x5f\x69\x64\12\40\40\x20\x20\40\x20\40\x20\x20\x20\40\40\x20\x20\x20\x20\40\40\x57\x48\105\122\105\40\160\x2e\x75\163\x65\162\137\x69\144\40\x3d\x20\77"; $params = array($user["\x75\x73\x65\162\137\x69\144"]); $types = "\151"; if ($status) { $query .= "\x20\x41\116\104\x20\x70\x2e\x73\x74\141\164\165\163\x20\75\x20\x3f"; $params[] = $status; $types .= "\163"; } $query .= "\40\117\x52\104\x45\122\x20\x42\131\40\160\x2e\143\162\x65\x61\164\x65\144\x5f\141\164\40\x44\105\x53\x43\40\x4c\x49\x4d\111\x54\x20\x3f\40\x4f\x46\106\x53\x45\124\40\77"; $params[] = $limit; $params[] = $offset; $types .= "\x69\151"; $stmt = mysqli_prepare($this->connection, $query); mysqli_stmt_bind_param($stmt, $types, ...$params); mysqli_stmt_execute($stmt); $result = mysqli_stmt_get_result($stmt); $peminjaman = array(); while ($row = mysqli_fetch_assoc($result)) { $detail_stmt = mysqli_prepare($this->connection, "\x53\105\x4c\105\x43\x54\x20\160\144\x2e\52\54\x20\x62\56\156\x61\155\x61\137\x62\141\162\141\156\147\54\40\x62\x2e\x6b\x6f\x64\145\137\142\x61\162\x61\156\147\12\40\40\40\x20\x20\x20\40\40\40\x20\40\x20\x20\40\40\x20\40\x46\122\x4f\115\x20\160\145\x6d\151\156\x6a\x61\155\x61\x6e\x5f\144\x65\164\x61\151\x6c\x20\160\144\12\40\40\40\x20\x20\40\x20\x20\40\40\40\40\x20\x20\40\40\40\112\x4f\x49\x4e\40\x62\x61\162\141\156\x67\x20\142\40\117\x4e\40\x70\144\x2e\x62\x61\162\141\156\147\x5f\151\144\x20\x3d\40\x62\56\142\141\x72\x61\x6e\x67\137\x69\x64\xa\x20\40\40\40\x20\x20\x20\x20\40\x20\40\x20\40\x20\40\40\40\127\x48\105\x52\105\x20\x70\144\56\x70\145\155\151\x6e\152\141\x6d\x61\x6e\x5f\x69\144\40\x3d\x20\77"); mysqli_stmt_bind_param($detail_stmt, "\x69", $row["\x70\145\155\151\x6e\152\x61\155\x61\x6e\x5f\x69\144"]); mysqli_stmt_execute($detail_stmt); $detail_result = mysqli_stmt_get_result($detail_stmt); $row["\151\x74\145\155\x73"] = mysqli_fetch_all($detail_result, MYSQLI_ASSOC); $peminjaman[] = $row; } $this->respond(array("\163\x75\x63\x63\145\x73\x73" => true, "\x64\x61\164\x61" => $peminjaman), 200); } public function createPeminjaman() { $user = $this->requireAuth(); $input = json_decode(file_get_contents("\160\x68\x70\72\57\x2f\151\156\x70\x75\164"), true); if (!isset($input["\164\x61\x6e\147\x67\141\154\137\160\151\x6e\152\141\x6d"]) || !isset($input["\164\x61\156\147\147\141\x6c\x5f\x6b\x65\x6d\x62\x61\x6c\151\137\162\x65\x6e\x63\141\x6e\x61"]) || !isset($input["\x69\x74\x65\x6d\x73"])) { $this->respond(array("\x73\x75\143\x63\145\163\x73" => false, "\x6d\x65\x73\x73\x61\147\145" => "\122\145\x71\x75\x69\x72\x65\x64\40\x66\151\145\154\x64\163\x3a\40\x74\141\156\x67\x67\141\x6c\x5f\x70\151\x6e\152\x61\x6d\54\x20\164\141\156\x67\x67\141\x6c\137\153\x65\x6d\142\x61\x6c\x69\x5f\x72\x65\156\x63\x61\156\x61\54\40\151\164\145\x6d\x73"), 400); } mysqli_begin_transaction($this->connection); try { $kode = "\x50\112\x4d\x2d" . date("\131\x6d\x64") . "\55" . str_pad(rand(1, 9999), 4, "\60", STR_PAD_LEFT); $date1 = new DateTime($input["\x74\141\156\x67\x67\141\x6c\137\x70\151\156\152\141\155"]); $date2 = new DateTime($input["\164\x61\x6e\x67\147\141\154\137\153\x65\x6d\x62\141\x6c\151\x5f\x72\145\156\143\x61\x6e\x61"]); $durasi = max(1, $date2->diff($date1)->days); $stmt = mysqli_prepare($this->connection, "\111\x4e\x53\x45\x52\x54\x20\111\x4e\x54\x4f\x20\160\x65\x6d\151\x6e\x6a\141\155\141\156\x20\50\153\157\x64\x65\x5f\x70\145\155\x69\156\152\141\155\141\x6e\54\x20\165\163\145\x72\x5f\x69\x64\x2c\40\164\141\x6e\x67\147\141\154\x5f\x70\x69\156\x6a\x61\x6d\54\40\x6a\x61\x6d\x5f\160\151\156\x6a\141\155\x2c\x20\xa\40\x20\x20\40\40\x20\40\40\40\x20\x20\40\40\x20\x20\x20\x74\x61\x6e\147\x67\141\154\137\153\145\x6d\142\x61\154\x69\137\162\x65\x6e\x63\141\x6e\x61\54\40\152\x61\x6d\x5f\153\x65\155\142\141\x6c\x69\137\162\145\156\143\141\156\x61\x2c\40\x6b\x65\160\145\x72\x6c\x75\x61\156\54\40\144\x75\x72\141\163\151\137\x68\141\x72\x69\x2c\40\x73\x74\x61\x74\165\163\x29\xa\x20\x20\x20\40\x20\x20\x20\40\x20\40\40\40\x20\x20\40\x20\x56\x41\114\125\105\123\40\50\77\x2c\40\x3f\x2c\x20\x3f\54\40\x3f\54\40\77\54\x20\x3f\x2c\x20\x3f\x2c\40\77\x2c\x20\x27\x70\145\156\x64\x69\x6e\x67\x27\x29"); $jam_pinjam = $input["\x6a\141\155\137\x70\151\156\x6a\141\155"] ?? "\x30\x38\72\60\60\72\x30\60"; $jam_kembali = $input["\152\141\x6d\137\153\145\155\x62\141\154\x69\x5f\x72\145\x6e\x63\141\156\x61"] ?? "\61\x37\72\x30\60\72\60\60"; $keperluan = $input["\x6b\x65\160\x65\x72\x6c\165\141\x6e"] ?? ''; mysqli_stmt_bind_param($stmt, "\163\151\163\163\x73\x73\x73\x69", $kode, $user["\165\163\145\162\x5f\151\x64"], $input["\164\x61\x6e\x67\147\141\x6c\137\x70\x69\x6e\x6a\x61\x6d"], $jam_pinjam, $input["\x74\141\x6e\x67\x67\141\x6c\x5f\153\145\155\142\141\154\x69\x5f\162\x65\x6e\x63\141\156\x61"], $jam_kembali, $keperluan, $durasi); mysqli_stmt_execute($stmt); $peminjaman_id = mysqli_insert_id($this->connection); $total_sewa = 0; $total_deposit = 0; foreach ($input["\x69\x74\145\155\163"] as $item) { $barang_stmt = mysqli_prepare($this->connection, "\x53\105\114\105\103\x54\x20\x2a\40\x46\x52\117\x4d\40\x62\x61\162\141\156\x67\40\127\110\105\122\x45\x20\142\141\162\141\x6e\x67\x5f\x69\144\40\75\40\77\x20\x41\116\x44\40\152\x75\x6d\154\141\150\x5f\x74\x65\x72\x73\145\144\x69\141\40\76\75\x20\77"); mysqli_stmt_bind_param($barang_stmt, "\151\x69", $item["\x62\x61\x72\141\x6e\147\x5f\151\144"], $item["\152\x75\x6d\x6c\x61\150"]); mysqli_stmt_execute($barang_stmt); $barang_result = mysqli_stmt_get_result($barang_stmt); $barang = mysqli_fetch_assoc($barang_result); if (!$barang) { throw new Exception("\102\141\x72\141\156\147\x20\111\104\40{$item["\x62\141\x72\141\x6e\x67\x5f\x69\144"]}\40\164\x69\144\141\x6b\x20\164\x65\x72\163\145\x64\x69\x61"); } $subtotal_sewa = $barang["\150\141\162\147\x61\x5f\163\145\167\141\x5f\160\x65\x72\137\x68\141\x72\x69"] * $item["\152\x75\155\x6c\x61\150"] * $durasi; $subtotal_deposit = $barang["\x64\x65\160\x6f\163\151\164"] * $item["\x6a\x75\x6d\x6c\141\150"]; $total_sewa += $subtotal_sewa; $total_deposit += $subtotal_deposit; $detail_stmt = mysqli_prepare($this->connection, "\x49\116\123\105\x52\124\40\111\116\124\117\40\160\145\155\151\x6e\152\x61\155\x61\156\x5f\x64\145\x74\x61\151\x6c\x20\xa\40\x20\x20\x20\40\x20\40\x20\x20\x20\40\x20\x20\40\x20\40\x20\40\40\40\x28\x70\145\x6d\151\156\152\x61\155\141\x6e\x5f\151\x64\54\x20\x62\x61\162\141\x6e\147\x5f\x69\x64\54\x20\152\x75\x6d\x6c\x61\150\54\x20\x68\141\162\x67\x61\x5f\163\x65\167\x61\x5f\160\x65\162\137\150\141\162\151\54\x20\x64\x65\x70\x6f\163\151\x74\137\160\145\162\x5f\151\x74\145\155\x2c\x20\12\40\40\x20\x20\x20\x20\40\x20\40\40\40\x20\40\x20\40\40\40\40\40\x20\144\x75\x72\141\x73\x69\x5f\x68\x61\162\x69\54\40\x73\165\142\x74\x6f\x74\141\x6c\137\163\145\167\x61\x2c\x20\x73\x75\142\x74\x6f\164\x61\154\137\x64\145\x70\157\x73\151\164\51\xa\40\x20\x20\x20\40\x20\40\x20\40\x20\40\40\x20\x20\40\x20\40\x20\40\x20\x56\101\114\x55\x45\123\40\50\x3f\54\x20\x3f\x2c\x20\x3f\54\x20\x3f\54\40\x3f\x2c\40\x3f\54\x20\77\54\x20\77\x29"); mysqli_stmt_bind_param($detail_stmt, "\151\151\x69\144\x64\151\144\x64", $peminjaman_id, $item["\x62\141\162\x61\156\x67\137\x69\144"], $item["\152\165\x6d\154\x61\x68"], $barang["\x68\x61\162\x67\x61\137\x73\145\167\x61\137\160\145\x72\137\150\141\162\x69"], $barang["\144\x65\x70\157\x73\151\x74"], $durasi, $subtotal_sewa, $subtotal_deposit); mysqli_stmt_execute($detail_stmt); } $total_bayar = $total_sewa + $total_deposit; $status_bayar = $total_bayar > 0 ? "\142\145\x6c\x75\x6d\x5f\x62\141\x79\x61\x72" : "\147\162\x61\164\151\x73"; $update_stmt = mysqli_prepare($this->connection, "\x55\120\x44\101\124\105\x20\160\x65\x6d\151\x6e\152\141\x6d\x61\156\x20\123\105\x54\x20\142\151\x61\171\x61\x5f\x73\x65\x77\x61\x20\75\40\77\54\40\142\x69\141\x79\x61\x5f\x64\x65\x70\157\x73\151\x74\40\75\40\x3f\54\40\12\x20\40\40\x20\40\40\40\x20\x20\x20\x20\x20\40\x20\40\40\164\x6f\164\x61\x6c\x5f\142\141\171\x61\162\40\x3d\x20\x3f\x2c\40\x73\164\x61\x74\x75\163\137\x70\x65\155\x62\141\171\141\162\141\x6e\40\75\40\x3f\40\x57\x48\105\x52\105\40\160\x65\155\151\156\x6a\141\155\x61\x6e\x5f\x69\x64\x20\x3d\x20\77"); mysqli_stmt_bind_param($update_stmt, "\144\144\x64\163\x69", $total_sewa, $total_deposit, $total_bayar, $status_bayar, $peminjaman_id); mysqli_stmt_execute($update_stmt); mysqli_commit($this->connection); $this->respond(array("\x73\x75\x63\143\145\163\163" => true, "\155\x65\x73\163\x61\147\x65" => "\x50\x65\155\x69\x6e\x6a\x61\155\141\156\40\x63\x72\145\x61\164\145\144\40\x73\165\x63\x63\x65\x73\x73\146\x75\154\x6c\171", "\x64\141\x74\141" => array("\160\145\155\x69\x6e\152\141\x6d\x61\156\x5f\151\x64" => $peminjaman_id, "\x6b\x6f\x64\145\137\160\x65\x6d\151\156\x6a\x61\x6d\141\x6e" => $kode, "\x74\157\x74\x61\154\x5f\142\x61\171\141\x72" => $total_bayar, "\x73\164\x61\164\165\163" => "\x70\145\x6e\x64\x69\x6e\x67")), 201); } catch (Exception $e) { mysqli_rollback($this->connection); $this->respond(array("\x73\165\143\143\145\163\x73" => false, "\x6d\x65\x73\163\x61\147\x65" => "\106\141\x69\154\x65\x64\x20\164\157\x20\x63\162\145\141\x74\145\40\160\x65\155\x69\156\152\x61\x6d\141\156\72\x20" . $e->getMessage()), 500); } } public function getKategori() { $this->requireAuth(); $result = mysqli_query($this->connection, "\123\105\114\105\103\x54\x20\52\40\106\x52\x4f\x4d\x20\x6b\x61\164\145\x67\x6f\x72\151\x20\x4f\x52\104\105\122\x20\x42\131\40\156\141\x6d\x61\137\153\x61\x74\145\147\157\162\x69"); $kategori = mysqli_fetch_all($result, MYSQLI_ASSOC); $this->respond(array("\x73\165\143\x63\x65\163\x73" => true, "\x64\141\164\141" => $kategori), 200); } } goto tU4KQ; C1lvR: $uri_parts = explode("\x3f", $request_uri); goto U2Fcc; hsKUZ: require_once __DIR__ . "\57\56\56\x2f\143\x6f\x6e\x66\x69\x67\x2f\144\141\164\141\x62\x61\163\145\x2e\160\x68\x70"; goto Zwnmr; UwpzE: $base_path = "\57\141\x70\x69\x2f\x76\x31"; goto ylhGd; tU4KQ: $request_uri = $_SERVER["\122\105\x51\x55\105\123\124\137\x55\x52\x49"]; goto vwvuL; U2Fcc: $path = $uri_parts[0]; goto UwpzE; xHqpU: $api = new ApiController($connection); goto uu4Uw; vwvuL: $request_method = $_SERVER["\x52\105\x51\125\x45\x53\124\137\x4d\105\x54\x48\117\104"]; goto C1lvR; Zwnmr: require_once __DIR__ . "\x2f\141\x75\164\150\56\160\x68\160"; goto fVY_F; uu4Uw: if ($request_method === "\x50\117\x53\x54" && $path === "\57\141\165\164\x68\x2f\154\157\x67\x69\156") { $api->login(); } elseif ($request_method === "\107\105\124" && $path === "\x2f\142\141\x72\x61\x6e\147") { $api->getBarang(); } elseif ($request_method === "\x47\x45\x54" && preg_match("\x2f\x5e\134\57\142\141\x72\141\x6e\x67\x5c\x2f\x28\x5c\x64\x2b\51\x24\x2f", $path, $matches)) { $api->getBarangById($matches[1]); } elseif ($request_method === "\x47\x45\x54" && $path === "\57\x70\145\x6d\151\156\152\141\155\141\x6e") { $api->getPeminjaman(); } elseif ($request_method === "\x50\117\x53\124" && $path === "\57\x70\145\x6d\151\156\152\141\155\x61\x6e") { $api->createPeminjaman(); } elseif ($request_method === "\107\105\124" && $path === "\x2f\153\141\164\x65\147\157\x72\x69") { $api->getKategori(); } else { http_response_code(404); echo json_encode(array("\163\x75\143\x63\145\163\163" => false, "\x6d\x65\x73\163\x61\147\x65" => "\105\x6e\x64\x70\157\x69\156\x74\40\x6e\x6f\164\40\146\157\165\156\x64")); }