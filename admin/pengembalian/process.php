<?php
 goto dkt1F; bt1io: mysqli_stmt_close($stmt); goto f4yrl; NTxyu: ?>
</td></tr><tr><td><strong>Target Kembali:</strong></td><td><?php  goto c7oUr; m9Kv8: ?>
</td></tr><tr><td><strong>Status:</strong></td><td><?php  goto ijIAJ; ijIAJ: if ($peminjaman["\163\164\x61\x74\x75\x73"] == "\154\x61\164\145") { ?>
<span class="badge bg-danger">TERLAMBAT</span><?php  } else { ?>
<span class="badge bg-success">ON TIME</span><?php  } goto rN5bv; Per1k: ?>
"required></div><div class="col-md-6"><label class="form-label">Jam Kembali <span class="text-danger">*</span></label> <input class="form-control"name="jam_kembali"type="time"value="<?php  goto JR5BQ; ZLIkh: echo $peminjaman["\153\157\144\x65\137\x70\145\x6d\151\156\152\141\x6d\x61\156"]; goto bzvpj; XNs3W: require_once __DIR__ . "\x2f\56\56\57\56\56\x2f\x6c\x69\142\57\141\165\164\x68\x2e\160\x68\x70"; goto a_lhM; c7oUr: echo date("\144\57\155\x2f\131\40\110\x3a\151", strtotime($peminjaman["\164\141\x6e\147\x67\141\x6c\137\153\145\155\x62\141\x6c\151\x5f\162\x65\x6e\143\x61\x6e\x61"] . "\40" . $peminjaman["\152\x61\155\137\153\x65\x6d\142\x61\x6c\151\137\x72\145\156\x63\x61\x6e\141"])); goto m9Kv8; YSOm2: echo formatRupiah($denda_info["\x74\157\164\x61\154\x5f\144\x65\156\144\141"]); goto So3Si; OQ0TU: $peminjaman = $data; goto vRwKB; JR5BQ: echo date("\x48\x3a\151"); goto qXzEF; GXUI0: $details = mysqli_stmt_get_result($stmt); goto bt1io; M4ahv: $request_query = "\xa\x20\x20\40\x20\123\x45\114\x45\103\x54\40\x70\x72\x2e\x2a\54\40\xa\x20\x20\x20\40\x20\40\x20\x20\40\x20\40\x70\x2e\52\54\40\12\x20\x20\40\40\40\40\x20\40\x20\40\x20\x75\56\156\141\x6d\x61\137\x6c\145\156\147\x6b\141\160\x2c\x20\12\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\40\165\56\x65\155\x61\x69\154\54\x20\12\x20\40\40\40\x20\x20\40\x20\40\40\x20\165\x2e\x64\x65\x70\141\x72\x74\x65\x6d\x65\x6e\54\12\40\40\40\40\x20\40\40\x20\40\40\40\x28\x53\x45\x4c\x45\103\x54\x20\x43\117\125\116\x54\x28\52\x29\40\106\122\117\x4d\x20\x70\145\155\x69\x6e\152\141\155\x61\x6e\x5f\x64\145\x74\x61\x69\x6c\40\x57\x48\105\122\x45\40\160\145\x6d\x69\156\x6a\141\x6d\x61\156\137\x69\144\x20\x3d\40\160\56\x70\x65\155\x69\x6e\x6a\141\x6d\141\x6e\x5f\151\x64\x29\x20\141\x73\40\x6a\165\x6d\154\x61\150\137\x69\x74\145\155\12\40\x20\x20\40\106\122\x4f\115\x20\x70\145\162\x6d\x69\x6e\164\141\x61\x6e\x5f\160\x65\x6e\x67\145\x6d\x62\141\x6c\151\x61\x6e\40\x70\162\12\40\40\40\40\111\x4e\x4e\105\122\40\x4a\x4f\x49\x4e\40\x70\145\x6d\x69\x6e\x6a\x61\x6d\x61\156\40\x70\x20\x4f\116\40\x70\162\x2e\x70\145\x6d\x69\156\x6a\x61\155\x61\x6e\x5f\151\144\40\75\40\160\x2e\x70\x65\x6d\x69\x6e\x6a\x61\155\x61\x6e\x5f\151\144\12\40\40\40\40\x4c\x45\x46\x54\40\x4a\117\x49\116\x20\x75\163\x65\162\163\x20\165\40\117\x4e\40\160\162\x2e\x75\x73\x65\162\137\x69\x64\x20\75\x20\165\56\165\x73\x65\x72\x5f\x69\144\xa\x20\x20\x20\40\127\x48\x45\122\105\x20\160\162\56\x70\145\x72\x6d\151\x6e\164\141\x61\x6e\137\151\x64\40\75\40\77\40\xa\40\40\40\x20\x41\x4e\x44\x20\160\x72\56\163\164\141\x74\x75\x73\x20\x3d\x20\47\141\160\x70\162\x6f\x76\145\x64\47\12\x20\40\x20\40\101\x4e\x44\x20\x70\x2e\163\x74\x61\164\165\163\x20\x49\116\40\x28\x27\x6f\x6e\147\x6f\151\156\147\47\x2c\x20\x27\x6c\141\164\x65\x27\51\xa"; goto IE_az; rN5bv: ?>
</td></tr></table><?php  goto x7LZW; F5iox: echo $peminjaman["\144\145\x70\141\x72\x74\x65\155\145\x6e"]; goto NTxyu; bzvpj: ?>
</td></tr><tr><td><strong>User:</strong></td><td><?php  goto SPkVv; y15Md: $flash = getFlashMessage(); goto vDZVt; guw94: ?>
<div class="row"><div class="col-lg-5"><div class="card"><div class="card-header"><h5><i class="fas me-2 fa-info-circle"></i>Informasi Peminjaman</h5></div><div class="card-body"><table class="table table-borderless"><tr><td><strong>Kode:</strong></td><td><?php  goto ZLIkh; obw9i: mysqli_stmt_close($stmt); goto ua5Ik; C7iga: echo date("\131\55\155\55\144"); goto Per1k; JTk3B: ?>
<div class="content"><div class="d-flex align-items-center justify-content-between mb-4"><h2><i class="fas me-2 fa-tasks text-primary"></i>Proses Pengembalian Barang</h2><a class="btn btn-secondary"href="index.php?tab=permintaan"><i class="fas me-2 fa-arrow-left"></i>Kembali</a></div><?php  goto xbqpG; ua5Ik: if (!$data) { setFlashMessage("\145\x72\x72\x6f\162", "\120\145\x72\x6d\151\156\x74\x61\x61\x6e\x20\160\x65\156\x67\x65\155\142\141\x6c\x69\141\x6e\x20\164\x69\144\141\x6b\x20\x76\x61\x6c\151\144\x20\x61\164\141\165\40\x62\x65\x6c\165\x6d\x20\144\151\163\145\x74\165\x6a\165\151\x21"); header("\114\x6f\x63\x61\x74\151\x6f\156\72\x20\151\x6e\144\145\x78\56\x70\150\x70\x3f\x74\141\x62\x3d\160\x65\162\x6d\x69\x6e\164\141\141\x6e"); die; } goto r9snh; mCTVd: include __DIR__ . "\x2f\x2e\56\x2f\56\x2e\x2f\166\151\145\x77\163\x2f\144\145\146\141\x75\154\164\x2f\x73\151\144\x65\142\141\162\x5f\141\144\x6d\x69\156\x2e\160\150\x70"; goto JTk3B; l_CP8: if ($request_id <= 0) { setFlashMessage("\x65\x72\162\157\162", "\122\x65\x71\165\x65\x73\x74\x20\x49\104\x20\164\x69\x64\141\153\40\166\141\154\151\144\x21"); header("\114\x6f\x63\141\164\151\157\156\72\x20\x69\x6e\x64\145\x78\x2e\x70\150\x70\x3f\x74\x61\142\x3d\160\x65\162\155\151\x6e\164\x61\141\x6e"); die; } goto M4ahv; ol1cy: echo formatRupiah($denda_info["\164\157\x74\141\154\x5f\x64\x65\156\144\x61"]); goto nbdX_; YnEhO: mysqli_stmt_bind_param($stmt, "\151", $peminjaman_id); goto wrPeG; a_lhM: requireAdmin(); goto ZwfD8; wrPeG: mysqli_stmt_execute($stmt); goto GXUI0; yuV0E: ?>
</div></div><div class="card"><div class="card-header"><h5><i class="fas me-2 fa-box"></i>Barang yang Dikembalikan</h5></div><div class="card-body"><?php  goto gGB0i; vDZVt: ?>
<!doctypehtml><html lang="id"><head><meta charset="UTF-8"><meta content="width=device-width,initial-scale=1"name="viewport"><title>Proses Pengembalian - Admin</title><link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"rel="stylesheet"><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"rel="stylesheet"><style>@import url(https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap);body{font-family:Poppins,sans-serif;background:linear-gradient(135deg,#e0f2fe 0,#dbeafe 50%,#e0e7ff 100%);min-height:100vh}.content{margin-left:260px;padding:40px}.card{border:none;border-radius:15px;box-shadow:0 4px 20px rgba(0,0,0,.08);margin-bottom:25px}.card-header{background:linear-gradient(135deg,#1e40af,#3b82f6);color:#fff;border-radius:15px 15px 0 0!important;padding:20px 25px;border:none}.info-box{background:#f0f9ff;border-left:4px solid #3b82f6;padding:15px;border-radius:8px;margin-bottom:20px}.warning-box{background:#fef3c7;border-left:4px solid #f59e0b;padding:15px;border-radius:8px;margin-bottom:20px}.danger-box{background:#fee2e2;border-left:4px solid #ef4444;padding:15px;border-radius:8px;margin-bottom:20px}.calculation-card{background:linear-gradient(135deg,#f9fafb,#f3f4f6);border:2px solid #e5e7eb;border-radius:12px;padding:20px}.calc-row{display:flex;justify-content:space-between;padding:10px 0;border-bottom:1px solid #e5e7eb}.calc-row:last-child{border-bottom:none;padding-top:15px;margin-top:10px;border-top:2px solid #3b82f6}.calc-total{font-size:1.5rem;font-weight:800;color:#1e40af}.kondisi-group .form-check{background:#fff;border:2px solid #e5e7eb;padding:15px;border-radius:10px;margin-bottom:10px;transition:all .3s}.kondisi-group .form-check:hover{border-color:#3b82f6;background:#f0f9ff}.kondisi-group .form-check-input:checked+.form-check-label{color:#1e40af;font-weight:600}</style></head><body><?php  goto mCTVd; IE_az: $stmt = mysqli_prepare($connection, $request_query); goto XIHq0; x7LZW: if ($denda_info["\150\141\x73\x5f\144\145\156\x64\141"]) { ?>
<div class="danger-box"><h6 class="text-danger mb-2"><i class="fas me-2 fa-exclamation-triangle"></i>Keterlambatan Terdeteksi</h6><p class="mb-1">Terlambat: <strong><?php  echo $denda_info["\x68\x61\162\151\137\164\145\162\x6c\141\155\142\x61\164"]; ?>
hari</strong></p><p class="mb-0">Denda: <strong><?php  echo formatRupiah($denda_info["\x74\157\x74\x61\x6c\137\x64\145\x6e\144\x61"]); ?>
</strong></p></div><?php  } else { ?>
<div class="info-box"><i class="fas me-2 fa-check-circle text-success"></i> <strong>Tidak ada denda keterlambatan</strong></div><?php  } goto yuV0E; dkt1F: session_start(); goto rA4A7; cFxcs: $request_id = isset($_GET["\x72\145\x71\x75\145\163\x74\x5f\x69\144"]) ? (int) $_GET["\162\x65\x71\165\145\163\164\x5f\151\x64"] : 0; goto l_CP8; SPkVv: echo htmlspecialchars($peminjaman["\156\141\x6d\141\x5f\154\145\156\147\153\x61\160"]); goto DhFLc; gwrl9: mysqli_stmt_execute($stmt); goto ftHOa; UOhkw: while ($item = mysqli_fetch_assoc($details)) { ?>
<div class="mb-3 align-items-center bg-light d-flex p-2 rounded"><div><h6 class="mb-1"><?php  echo htmlspecialchars($item["\156\x61\x6d\x61\137\142\141\162\x61\156\147"]); ?>
</h6><small class="text-muted">Kode:<?php  echo $item["\153\157\x64\145\137\142\x61\162\141\x6e\x67"]; ?>
| Qty:<?php  echo $item["\152\x75\155\154\x61\x68"]; ?>
</small></div></div><?php  } goto FCPj_; vLkUs: require_once __DIR__ . "\57\x2e\56\57\56\56\57\x6c\151\x62\x2f\x66\x75\x6e\x63\164\x69\157\156\x73\56\x70\150\x70"; goto XNs3W; r9snh: $peminjaman_id = $data["\x70\145\155\x69\156\x6a\141\155\141\156\x5f\x69\144"]; goto OQ0TU; ASJzb: if ($_SERVER["\x52\x45\121\125\105\x53\124\137\x4d\105\x54\110\x4f\x44"] == "\x50\x4f\123\124") { $tanggal_kembali = $_POST["\x74\141\156\147\x67\x61\154\137\153\x65\155\x62\x61\x6c\x69"]; $jam_kembali = $_POST["\x6a\141\155\x5f\153\x65\155\142\141\x6c\151"]; $kondisi_umum = $_POST["\153\x6f\156\144\151\163\x69\x5f\x62\141\162\x61\x6e\147"]; $biaya_kerusakan = (double) ($_POST["\x62\151\x61\x79\x61\137\153\145\162\x75\163\141\x6b\141\156"] ?? 0); $biaya_kehilangan = (double) ($_POST["\142\151\x61\171\141\x5f\x6b\145\150\151\x6c\x61\156\147\141\x6e"] ?? 0); $catatan_admin = trim($_POST["\143\x61\x74\141\x74\141\156"] ?? ''); $total_biaya_kerusakan = $biaya_kerusakan + $biaya_kehilangan; $denda_keterlambatan = $denda_info["\164\157\164\141\154\x5f\144\x65\x6e\x64\x61"]; $total_denda = $denda_keterlambatan + $total_biaya_kerusakan; mysqli_begin_transaction($connection); try { if ($total_denda > 0) { $update_peminjaman = "\xa\40\40\40\40\x20\x20\x20\x20\x20\40\40\40\40\x20\40\x20\125\120\104\101\124\x45\40\x70\145\x6d\151\156\x6a\141\x6d\x61\156\x20\xa\x20\40\40\x20\x20\40\40\40\x20\40\x20\x20\x20\x20\x20\x20\x53\x45\124\40\x73\164\x61\x74\165\x73\40\75\40\x27\160\x65\x6e\x64\151\x6e\x67\x5f\160\141\x79\155\x65\x6e\164\47\54\xa\40\40\x20\40\40\x20\x20\x20\x20\40\40\40\x20\40\40\40\40\40\40\x20\164\141\156\147\x67\x61\x6c\x5f\153\145\155\x62\141\154\x69\137\141\x63\x74\165\x61\x6c\40\x3d\x20\x3f\x2c\xa\x20\x20\x20\40\40\40\x20\x20\40\40\40\x20\40\40\40\x20\x20\40\40\x20\152\141\x6d\x5f\x6b\145\x6d\x62\141\154\x69\137\141\x63\164\165\x61\154\x20\75\40\77\54\xa\x20\x20\x20\x20\x20\40\40\40\x20\40\x20\x20\40\40\40\x20\x20\40\40\x20\x68\x61\x72\x69\x5f\x74\145\x72\154\141\x6d\142\141\164\40\75\40\x3f\x2c\xa\x20\x20\40\40\x20\40\x20\x20\x20\40\40\40\40\x20\x20\x20\x20\40\40\x20\144\x65\x6e\x64\141\137\x6b\x65\x74\x65\x72\x6c\141\155\x62\141\164\x61\156\x20\75\40\77\54\12\40\x20\40\x20\x20\40\40\x20\40\x20\40\x20\40\x20\40\40\40\x20\40\x20\165\160\144\141\x74\145\144\137\x61\x74\40\75\x20\116\117\127\50\x29\xa\40\40\x20\x20\40\x20\40\x20\x20\40\x20\40\x20\40\x20\40\127\110\105\x52\x45\x20\160\145\155\x69\156\x6a\141\x6d\141\156\x5f\151\x64\x20\x3d\x20\77\12\x20\40\x20\x20\x20\40\40\40\40\x20\40\40"; $stmt = mysqli_prepare($connection, $update_peminjaman); mysqli_stmt_bind_param($stmt, "\163\x73\151\144\151", $tanggal_kembali, $jam_kembali, $denda_info["\150\141\162\x69\137\164\x65\x72\154\141\155\142\141\164"], $denda_keterlambatan, $peminjaman_id); if (!mysqli_stmt_execute($stmt)) { throw new Exception("\107\141\147\x61\x6c\40\x75\x70\144\x61\164\x65\40\160\145\155\151\156\152\141\x6d\x61\156\72\x20" . mysqli_error($connection)); } mysqli_stmt_close($stmt); $insert_tagihan = "\xa\x20\x20\40\40\40\x20\40\x20\x20\40\40\40\x20\x20\40\x20\x49\116\x53\105\x52\124\x20\111\x4e\x54\x4f\x20\x74\x61\x67\151\150\x61\156\137\x64\x65\x6e\x64\x61\40\xa\x20\x20\x20\x20\40\x20\x20\x20\40\40\40\40\x20\x20\x20\x20\x28\160\x65\x6d\x69\156\152\x61\x6d\x61\x6e\137\151\144\54\40\x75\x73\x65\162\x5f\151\x64\54\40\x64\145\x6e\144\141\x5f\153\x65\x74\145\162\154\141\155\142\x61\x74\141\156\54\40\x62\151\x61\x79\141\137\x6b\145\x72\165\x73\x61\153\141\x6e\x2c\40\x62\x69\x61\171\141\137\x6b\145\150\x69\x6c\141\156\147\141\156\54\40\xa\x20\40\x20\x20\40\x20\40\x20\40\40\40\40\40\40\40\40\x20\x74\x6f\x74\141\154\x5f\164\141\147\x69\150\141\x6e\x2c\40\x6b\x6f\x6e\144\x69\x73\x69\137\142\141\x72\141\x6e\x67\x2c\x20\x63\141\164\x61\164\x61\156\137\141\x64\x6d\x69\x6e\x2c\40\x73\x74\x61\164\x75\163\54\40\143\x72\145\x61\164\145\x64\x5f\141\x74\x29\12\40\40\x20\x20\x20\40\40\40\x20\40\40\40\40\40\40\40\x56\x41\x4c\x55\x45\123\40\x28\77\x2c\x20\x3f\x2c\40\77\54\40\x3f\x2c\40\77\x2c\x20\77\x2c\40\77\x2c\40\77\54\x20\x27\165\156\160\x61\151\144\47\54\x20\116\x4f\127\x28\x29\x29\12\x20\40\x20\40\x20\x20\x20\40\x20\40\40\x20"; $stmt = mysqli_prepare($connection, $insert_tagihan); mysqli_stmt_bind_param($stmt, "\151\151\144\x64\x64\x64\x73\x73", $peminjaman_id, $peminjaman["\165\x73\145\162\137\x69\x64"], $denda_keterlambatan, $biaya_kerusakan, $biaya_kehilangan, $total_denda, $kondisi_umum, $catatan_admin); if (!mysqli_stmt_execute($stmt)) { throw new Exception("\107\141\x67\x61\x6c\40\151\x6e\163\x65\162\x74\x20\164\141\x67\x69\x68\x61\x6e\x20\x64\x65\156\144\141\72\x20" . mysqli_error($connection)); } mysqli_stmt_close($stmt); $update_request = "\12\40\x20\x20\x20\40\40\40\40\x20\40\x20\x20\x20\40\x20\40\x55\120\x44\101\x54\105\x20\160\x65\x72\155\x69\156\164\141\x61\x6e\137\160\x65\x6e\147\x65\155\x62\141\x6c\x69\x61\x6e\40\12\x20\x20\40\x20\x20\x20\x20\x20\x20\40\x20\40\x20\40\x20\40\123\105\124\x20\163\x74\141\x74\x75\163\x20\x3d\x20\47\160\162\x6f\x63\x65\x73\x73\x65\144\x27\12\40\x20\40\x20\x20\x20\40\40\40\40\x20\40\x20\x20\x20\40\x57\110\105\x52\105\x20\160\145\x72\x6d\151\x6e\x74\x61\141\x6e\x5f\151\x64\40\x3d\40\77\xa\40\x20\x20\40\x20\40\40\40\x20\40\40\x20"; $stmt = mysqli_prepare($connection, $update_request); mysqli_stmt_bind_param($stmt, "\151", $request_id); mysqli_stmt_execute($stmt); mysqli_stmt_close($stmt); mysqli_commit($connection); setFlashMessage("\x73\x75\143\x63\x65\163\x73", "\120\145\156\147\x65\x6d\x62\x61\154\151\x61\x6e\x20\x64\151\x70\x72\157\x73\145\x73\x21\x20\124\x6f\164\x61\154\40\x64\x65\156\144\141\72\40" . formatRupiah($total_denda) . "\56\40\125\163\x65\162\x20\x64\151\x6d\x69\156\164\x61\40\x75\156\164\x75\x6b\x20\x6d\145\x6c\x61\x6b\x75\x6b\141\156\40\160\145\x6d\142\x61\171\141\x72\141\x6e\x2e"); header("\x4c\157\x63\x61\164\151\x6f\x6e\x3a\x20\x69\156\x64\145\170\x2e\x70\150\x70\77\x74\x61\x62\75\x70\x65\x6d\x62\x61\x79\141\x72\x61\x6e"); die; } else { $deposit_dikembalikan = $peminjaman["\142\151\141\x79\141\137\144\145\x70\157\x73\x69\164"]; $insert_pengembalian = "\12\x20\40\x20\40\40\x20\40\40\x20\x20\40\40\x20\x20\x20\40\x49\116\x53\105\122\124\x20\111\116\124\117\x20\160\x65\x6e\147\145\x6d\x62\141\154\151\141\x6e\x20\12\x20\x20\x20\40\x20\40\x20\x20\40\40\40\40\x20\40\40\x20\50\160\145\x6d\x69\156\x6a\141\x6d\x61\x6e\x5f\151\144\x2c\x20\x74\141\156\x67\147\x61\x6c\x5f\x70\x65\x6e\x67\x65\155\142\141\154\151\x61\x6e\54\40\144\151\164\x65\162\x69\x6d\141\x5f\x6f\154\145\x68\x2c\40\x6b\157\156\x64\151\163\x69\x5f\165\155\165\x6d\x2c\xa\40\40\x20\x20\40\40\x20\x20\x20\x20\40\40\40\x20\40\40\x20\142\151\x61\x79\x61\137\160\145\162\x62\x61\151\153\141\x6e\x2c\x20\144\x65\x70\157\x73\151\x74\137\141\167\x61\x6c\x2c\x20\x64\145\160\x6f\x73\151\164\137\144\x69\x70\x6f\x74\x6f\156\147\54\40\x64\x65\x70\x6f\x73\151\164\x5f\x64\x69\153\145\x6d\x62\141\x6c\151\x6b\x61\156\54\12\x20\40\40\x20\40\40\40\40\x20\x20\x20\x20\x20\40\x20\x20\40\143\x61\x74\x61\164\141\x6e\x5f\153\x65\162\x75\x73\x61\x6b\141\156\51\xa\40\40\40\40\40\40\x20\40\x20\x20\x20\x20\x20\40\40\x20\x56\x41\114\x55\x45\123\40\50\x3f\54\40\77\54\40\77\54\40\77\x2c\40\x30\54\40\x3f\54\40\x30\x2c\40\x3f\x2c\x20\x3f\x29\xa\40\40\40\x20\x20\40\40\x20\40\x20\40\40"; $tanggal_jam_kembali = $tanggal_kembali . "\40" . $jam_kembali; $stmt = mysqli_prepare($connection, $insert_pengembalian); mysqli_stmt_bind_param($stmt, "\x69\x73\151\163\x64\x64\163", $peminjaman_id, $tanggal_jam_kembali, $admin["\x75\x73\145\162\137\x69\144"], $kondisi_umum, $peminjaman["\142\151\141\171\x61\x5f\x64\145\160\157\x73\151\164"], $deposit_dikembalikan, $catatan_admin); if (!mysqli_stmt_execute($stmt)) { throw new Exception("\x47\x61\x67\141\154\x20\x69\x6e\163\x65\162\164\40\x70\145\x6e\147\x65\x6d\142\x61\x6c\151\141\x6e\x3a\x20" . mysqli_error($connection)); } mysqli_stmt_close($stmt); $update_peminjaman = "\12\40\40\40\40\x20\x20\x20\40\40\40\40\x20\x20\x20\x20\x20\x55\x50\x44\x41\x54\105\40\160\x65\x6d\x69\x6e\152\141\155\x61\156\x20\xa\x20\40\x20\x20\x20\x20\40\x20\40\40\x20\40\40\40\40\x20\x53\x45\124\40\x73\164\141\164\x75\163\40\75\x20\x27\162\x65\164\165\x72\x6e\x65\144\x27\54\12\40\x20\40\x20\40\x20\40\x20\40\40\40\x20\x20\40\40\x20\x20\40\40\40\x74\x61\x6e\x67\x67\x61\x6c\x5f\153\145\155\142\x61\154\151\137\x61\x63\x74\165\141\x6c\x20\x3d\40\77\54\12\x20\x20\x20\40\x20\40\40\x20\40\40\40\40\x20\40\x20\x20\40\x20\x20\x20\152\141\x6d\x5f\x6b\x65\155\142\141\x6c\151\x5f\x61\143\x74\165\x61\154\40\75\40\77\x2c\12\40\x20\40\40\40\x20\40\40\x20\x20\40\40\x20\40\x20\40\40\x20\x20\40\x75\x70\144\141\x74\x65\x64\137\x61\x74\40\75\x20\x4e\117\x57\x28\x29\12\x20\x20\x20\x20\x20\x20\40\40\x20\x20\x20\40\x20\40\40\40\x57\x48\105\x52\105\x20\160\145\x6d\151\156\152\141\155\x61\x6e\x5f\x69\144\x20\75\40\x3f\12\40\x20\x20\x20\x20\40\x20\x20\40\x20\40\40"; $stmt = mysqli_prepare($connection, $update_peminjaman); mysqli_stmt_bind_param($stmt, "\163\163\151", $tanggal_kembali, $jam_kembali, $peminjaman_id); if (!mysqli_stmt_execute($stmt)) { throw new Exception("\x47\141\147\x61\x6c\40\x75\x70\144\141\x74\x65\x20\x70\x65\155\x69\156\x6a\141\155\141\x6e\x3a\40" . mysqli_error($connection)); } mysqli_stmt_close($stmt); mysqli_data_seek($details, 0); while ($detail = mysqli_fetch_assoc($details)) { $update_stock = "\xa\x20\40\40\40\40\40\x20\x20\x20\x20\40\x20\40\x20\x20\x20\x20\40\40\x20\x55\120\104\x41\x54\x45\40\142\x61\162\141\156\147\40\12\40\x20\40\40\40\x20\40\40\40\40\40\40\x20\40\x20\40\x20\x20\40\x20\123\x45\x54\x20\x6a\165\x6d\154\141\x68\x5f\164\145\162\163\x65\x64\x69\141\40\75\x20\x6a\165\x6d\x6c\141\x68\x5f\164\x65\x72\163\x65\144\151\141\40\x2b\40\77\12\40\40\x20\40\x20\40\x20\40\x20\x20\x20\x20\x20\40\40\x20\40\40\40\x20\x57\110\x45\122\x45\x20\x62\x61\x72\141\x6e\x67\137\151\144\40\75\40\77\12\40\40\40\40\40\x20\x20\x20\40\40\40\40\x20\x20\40\40"; $stmt = mysqli_prepare($connection, $update_stock); mysqli_stmt_bind_param($stmt, "\x69\x69", $detail["\152\165\x6d\x6c\x61\x68"], $detail["\142\141\162\141\x6e\147\137\151\x64"]); mysqli_stmt_execute($stmt); mysqli_stmt_close($stmt); } $update_request = "\xa\40\40\x20\40\x20\x20\40\x20\x20\x20\x20\40\40\x20\x20\x20\125\x50\x44\x41\x54\105\40\160\145\162\x6d\151\156\x74\141\x61\156\137\x70\x65\x6e\x67\x65\x6d\142\141\154\151\x61\156\x20\xa\40\x20\x20\x20\40\x20\40\40\40\x20\x20\x20\x20\x20\x20\x20\x53\x45\124\40\163\x74\141\x74\x75\x73\40\x3d\x20\47\160\162\x6f\x63\145\x73\163\x65\144\47\xa\40\40\40\x20\x20\40\x20\40\x20\x20\40\x20\x20\40\x20\40\x57\110\105\x52\105\x20\x70\145\162\155\151\x6e\x74\x61\x61\156\137\x69\x64\40\x3d\x20\x3f\12\x20\40\x20\x20\x20\x20\40\x20\40\40\x20\40"; $stmt = mysqli_prepare($connection, $update_request); mysqli_stmt_bind_param($stmt, "\x69", $request_id); mysqli_stmt_execute($stmt); mysqli_stmt_close($stmt); mysqli_commit($connection); setFlashMessage("\163\165\x63\143\x65\x73\x73", "\120\x65\x6e\x67\x65\155\x62\141\x6c\151\x61\x6e\x20\142\145\x72\150\141\x73\x69\x6c\x20\x64\x69\160\162\x6f\x73\145\163\x21\x20\x54\151\x64\141\x6b\x20\141\x64\x61\x20\144\145\x6e\x64\141\x2e"); header("\114\157\x63\141\164\151\x6f\156\x3a\40\151\156\144\145\x78\56\x70\x68\x70\x3f\164\x61\142\75\162\151\x77\141\x79\141\164"); die; } } catch (Exception $e) { mysqli_rollback($connection); setFlashMessage("\x65\x72\162\157\x72", "\x45\162\162\157\x72\x3a\40" . $e->getMessage()); header("\x4c\x6f\x63\x61\x74\151\x6f\x6e\x3a\40\151\x6e\144\145\170\56\160\150\x70\77\x74\141\142\x3d\x70\x65\x72\155\151\x6e\x74\141\x61\156"); die; } } goto y15Md; nbdX_: ?>
</span></div></div><div class="mt-3 warning-box"><i class="fas me-2 fa-info-circle"></i> <strong>Catatan:</strong> Jika total tagihan > 0, user akan diminta untuk melakukan pembayaran sebelum pengembalian selesai diproses.</div><div class="d-flex gap-3 justify-content-end mt-4"><a class="btn btn-secondary"href="index.php?tab=permintaan"><i class="fas me-2 fa-times"></i>Batal </a><button class="btn btn-lg btn-primary"type="submit"><i class="fas me-2 fa-check"></i>Proses Pengembalian</button></div></form></div></div></div></div></div><script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script><script>// Show/hide biaya fields based on kondisi
document.querySelectorAll('input[name="kondisi_barang"]').forEach(radio => {
    radio.addEventListener('change', function() {
        const kerusakanDiv = document.getElementById('biayaKerusakanDiv');
        const kehilanganDiv = document.getElementById('biayaKehilanganDiv');
        
        if (this.value === 'Rusak Ringan') {
            kerusakanDiv.style.display = 'block';
            kehilanganDiv.style.display = 'none';
            document.getElementById('biayaKehilangan').value = 0;
        } else if (this.value === 'Hilang') {
            kerusakanDiv.style.display = 'none';
            kehilanganDiv.style.display = 'block';
            document.getElementById('biayaKerusakan').value = 0;
        } else {
            kerusakanDiv.style.display = 'none';
            kehilanganDiv.style.display = 'none';
            document.getElementById('biayaKerusakan').value = 0;
            document.getElementById('biayaKehilangan').value = 0;
        }
        updateCalculation();
    });
});

document.getElementById('biayaKerusakan').addEventListener('input', updateCalculation);
document.getElementById('biayaKehilangan').addEventListener('input', updateCalculation);

function updateCalculation() {
    const dendaTelat =<?php  goto BDBaa; f4yrl: $denda_info = getInfoDenda($peminjaman); goto ASJzb; FCPj_: ?>
</div></div></div><div class="col-lg-7"><div class="card"><div class="card-header"><h5><i class="fas me-2 fa-clipboard-check"></i>Form Inspeksi & Pengembalian</h5></div><div class="card-body"><form id="returnForm"method="POST"><div class="mb-3 row"><div class="col-md-6"><label class="form-label">Tanggal Kembali <span class="text-danger">*</span></label> <input class="form-control"name="tanggal_kembali"type="date"value="<?php  goto C7iga; XIHq0: mysqli_stmt_bind_param($stmt, "\151", $request_id); goto gwrl9; So3Si: ?>
</span></div><div class="calc-row"><span>Biaya Kerusakan</span> <span id="displayKerusakan">Rp 0</span></div><div class="calc-row"><span>Biaya Kehilangan</span> <span id="displayKehilangan">Rp 0</span></div><div class="calc-row"><span><strong>TOTAL TAGIHAN</strong></span> <span class="calc-total"id="displayTotal"><?php  goto ol1cy; sLxTg: $data = mysqli_fetch_assoc($result); goto obw9i; ftHOa: $result = mysqli_stmt_get_result($stmt); goto sLxTg; BDBaa: echo $denda_info["\x74\x6f\x74\x61\154\137\x64\145\x6e\144\x61"]; goto HKmyV; rA4A7: require_once __DIR__ . "\x2f\56\x2e\x2f\56\56\x2f\x63\x6f\x6e\146\151\x67\57\144\x61\164\x61\x62\x61\163\145\56\x70\150\x70"; goto vLkUs; Hl8Z0: $stmt = mysqli_prepare($connection, $details_query); goto YnEhO; qXzEF: ?>
"required></div></div><div class="mb-3"><label class="form-label">Kondisi Barang <span class="text-danger">*</span></label><div class="kondisi-group"><div class="form-check"><input class="form-check-input"name="kondisi_barang"type="radio"value="Baik"id="kondisi_baik"required> <label class="form-check-label"for="kondisi_baik"><i class="fas me-2 fa-check-circle text-success"></i>Baik (Tidak ada kerusakan)</label></div><div class="form-check"><input class="form-check-input"name="kondisi_barang"type="radio"value="Rusak Ringan"id="kondisi_rusak"> <label class="form-check-label"for="kondisi_rusak"><i class="fas me-2 fa-exclamation-triangle text-warning"></i>Rusak Ringan</label></div><div class="form-check"><input class="form-check-input"name="kondisi_barang"type="radio"value="Hilang"id="kondisi_hilang"> <label class="form-check-label"for="kondisi_hilang"><i class="fas me-2 fa-times-circle text-danger"></i>Hilang/Rusak Berat</label></div></div></div><div class="mb-3"id="biayaKerusakanDiv"style="display:none"><label class="form-label">Biaya Perbaikan Kerusakan</label><div class="input-group"><span class="input-group-text">Rp</span> <input class="form-control"name="biaya_kerusakan"type="number"value="0"id="biayaKerusakan"min="0"step="1000"></div><small class="text-muted">Biaya untuk perbaikan barang yang rusak</small></div><div class="mb-3"id="biayaKehilanganDiv"style="display:none"><label class="form-label">Biaya Penggantian Barang Hilang</label><div class="input-group"><span class="input-group-text">Rp</span> <input class="form-control"name="biaya_kehilangan"type="number"value="0"id="biayaKehilangan"min="0"step="1000"></div><small class="text-muted">Biaya untuk mengganti barang yang hilang</small></div><div class="mb-3"><label class="form-label">Catatan Inspeksi</label> <textarea class="form-control"name="catatan"placeholder="Jelaskan kondisi barang, kerusakan yang ditemukan, dll..."rows="3"></textarea></div><div class="calculation-card"><h6><i class="fas me-2 fa-calculator"></i>Perhitungan Total Denda</h6><div class="calc-row"><span>Denda Keterlambatan</span> <span id="displayDendaTelat"><?php  goto YSOm2; xbqpG: if ($flash) { ?>
<div class="alert alert-<?php  echo $flash["\x74\x79\x70\145"]; ?>
alert-dismissible fade show"><?php  echo htmlspecialchars($flash["\x6d\x65\163\x73\141\147\x65"]); ?>
<button class="btn-close"type="button"data-bs-dismiss="alert"></button></div><?php  } goto guw94; vRwKB: $details_query = "\xa\x20\x20\x20\x20\123\105\x4c\x45\x43\124\x20\160\144\56\52\x2c\40\12\40\40\x20\40\x20\40\x20\40\40\40\40\x62\56\x6e\x61\x6d\141\x5f\x62\141\x72\x61\x6e\147\54\40\12\x20\40\40\40\40\x20\40\x20\40\x20\40\142\x2e\x6b\x6f\x64\x65\137\142\141\162\x61\x6e\x67\54\12\x20\40\x20\40\x20\x20\40\40\x20\40\40\x62\x2e\x6b\x61\164\145\147\x6f\162\151\137\151\x64\x2c\12\x20\40\40\40\40\x20\x20\x20\x20\40\40\103\117\x41\114\x45\x53\x43\105\x28\x6b\56\156\141\155\x61\137\153\141\x74\145\x67\157\162\151\54\x20\x27\124\x61\156\x70\x61\x20\x4b\x61\164\x65\x67\x6f\x72\x69\x27\51\40\101\x53\40\x6e\141\155\x61\137\153\141\x74\x65\147\157\x72\151\12\40\40\40\40\x46\x52\x4f\x4d\x20\160\145\x6d\151\156\x6a\141\x6d\x61\156\137\x64\145\x74\141\x69\x6c\40\160\x64\xa\40\40\x20\40\x4c\105\106\x54\40\112\x4f\111\x4e\40\142\x61\x72\x61\156\147\x20\142\40\117\116\x20\x70\x64\56\x62\x61\x72\x61\x6e\147\137\151\144\x20\75\40\x62\56\x62\141\x72\x61\156\x67\x5f\x69\144\xa\x20\x20\x20\40\x4c\x45\x46\x54\x20\112\117\111\x4e\x20\153\141\164\x65\147\x6f\x72\151\x20\x6b\40\117\116\x20\142\56\x6b\141\164\145\147\157\x72\151\137\151\144\x20\x3d\40\153\56\153\141\164\145\147\157\x72\x69\137\151\144\xa\x20\x20\x20\x20\127\x48\x45\122\x45\x20\160\x64\56\x70\x65\x6d\x69\156\152\x61\155\x61\x6e\137\x69\144\x20\75\40\77\xa"; goto Hl8Z0; gGB0i: mysqli_data_seek($details, 0); goto UOhkw; ZwfD8: $admin = getCurrentUser(); goto cFxcs; DhFLc: ?>
</td></tr><tr><td><strong>Departemen:</strong></td><td><?php  goto F5iox; HKmyV: ?>
;
    const kerusakan = parseFloat(document.getElementById('biayaKerusakan').value) || 0;
    const kehilangan = parseFloat(document.getElementById('biayaKehilangan').value) || 0;
    
    const total = dendaTelat + kerusakan + kehilangan;
    
    document.getElementById('displayKerusakan').textContent = 'Rp ' + kerusakan.toLocaleString('id-ID');
    document.getElementById('displayKehilangan').textContent = 'Rp ' + kehilangan.toLocaleString('id-ID');
    document.getElementById('displayTotal').textContent = 'Rp ' + total.toLocaleString('id-ID');
}

document.getElementById('returnForm').addEventListener('submit', function(e) {
    const kondisi = document.querySelector('input[name="kondisi_barang"]:checked');
    if (!kondisi) {
        alert('Pilih kondisi barang terlebih dahulu!');
        e.preventDefault();
        return;
    }
    
    const total = document.getElementById('displayTotal').textContent;
    if (!confirm('Proses pengembalian dengan total tagihan: ' + total + '?')) {
        e.preventDefault();
    }
});</script></body></html>